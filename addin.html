# Create a new version of the HTML with Geotab-safe initialization and no API call

simplified_html = geotab_safe_html.replace(
    '''fetchVehicles();

                    if (callback) {
                        callback();
                    }''',
    '''showContent();
                    if (callback) {
                        callback();
                    }'''
).replace(
    '''
            async function fetchVehicles() {
                try {
                    console.log("Fetching vehicles...");
                    vehicles = await api.call("Get", {
                        typeName: "Device"
                    });
                    console.log(vehicles.length + " vehicles loaded successfully.");
                    showContent();
                } catch (err) {
                    console.error("Error fetching vehicles: ", err);
                    showError("Could not load vehicle data from Geotab. " + err.message);
                }
            }''',
    ''  # Completely remove the fetchVehicles() block
).replace(
    '''if (vehicles.length === 0) {
                    showError("No vehicles loaded from Geotab yet. Please wait a moment and try again.");
                    return;
                }

                if (rucData.length === 0) {''',
    '''if (rucData.length === 0) {'''
)

# Save the simplified version that doesn't rely on Geotab API call
simplified_path = Path("/mnt/data/ruc_addin_geotab_noworkingapi.html")
simplified_path.write_text(simplified_html)

simplified_path.name
